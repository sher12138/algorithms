# MPDM :假设受控车辆和其它参与者在每个时间步执行一组看似合理的闭环策略中的策略，选择最佳可用策略来执行。

*环境代理的不确定性*   --> *多代理交互建模* --> 

1. 有限离散策略集合作为车辆动作集合： $\add$   每一种策略表示一种特定的高级行为，例如车道保持或车道变更。
2. 通过确定性的闭环前向仿真来获取车辆观测模型

估计驾驶行为:
选择某种策略的概率$p(\pi_t^{v} | x_t^{v})$
假设能够估计其它车辆的行为策略 $\pi_t^{v}$，


## 算法过程：

1. 遍历所有策略，选择可行的，
1.1 生成其它车辆的策略及策略概率：我们的行为预期方法是基于对每辆车观察到的状态历史的分割，其中每个段都与最有可能在段中生成观察结果的策略相关联
我们使用贝叶斯变化点检测获得这种分割，它推断出生成观察变化的潜在策略的观察历史中的点。
获取当前帧车辆所有可能策略的分布 $p(\pi_t^v | x_t, Z_{0:t})$ $Z_{0:t}$ 为历史观察
此外，完整的历史分割允许我们检测我们的系统中策略集无法解释的异常行为

*changepoint-detection procedure*
```latex
# 1. 获取其历史观测状态： $Z_{1:n} = (z_1,z_2,...z_n)$， 和策略集合。

# 2. CHMAP推断MAP 集，分成m+1段， \tau = (\tau_1, \tau_2, ... \tau_m)
# 3. 因此，第 $i^{th}$ 段包含观测 $Z_{\tau_{i-1}+1:\tau_i}$ 与策略 $\pi_i$ ，参数 $\theta_i$
# 4. 建模变点位置为 Markov 链，
# 5. $p(\tau_{i+1} = t | \tau_i = s) = g(t-s) $  # 概率密度函数 

g(\dot) = G(\dot)  概率密度函数  分布函数 

对一个段 (s,t) -> \pi  

log L(s,t,\pi) = log p(Z_{s+1:t} | \pi, \hat{\theta^}) - 1/ 2  k_{\pi} log(t-s)  # k_{\pi} 为策略的参数个数



```


2. 前向仿真选择最好的策略
## 文献翻译
真实世界自动驾驶必须与拥有不确定意图的其它道路使用者进行交互，文献中先前的工作通常使用自组织解决方案来解决这个问题，这些解决方案不考虑其他代理未来可能的状态，因此很难扩展到复杂的流量场景，在这些场景中，参与代理的行为严格取决于彼此。在本文中，我们提出了多极决策（MPDM），这是一种利用自动驾驶领域的知识为自动驾驶汽车在交通中导航在线做出决策的决策算法。通过假设受控车辆和其他交通参与者在每个时间步长执行一组看似合理的闭环策略中的策略，算法为受控车辆选择最佳可用策略来执行。我们使用受控车辆和其他代理的正向模拟来执行策略选择，有效地从它们相互作用的高可能性结果中进行采样。我们使用受控车辆和其他代理的正向模拟来执行策略选择，有效地从它们相互作用的高可能性结果中进行采样。然后，我们使用用户定义的成本函数对结果进行评分，以适应不同的驾驶偏好，并选择得分最高的策略。


# 自动驾驶的多策略和风险意识应急规划

不确定性下规划的困难源于不完善的观察
道路使用者固有的多模式意图无法直接观察

POMDP --> 高耗时 -->随机环境下决策过程的数学严谨公式

将原始问题分解为有限数量的闭环策略

方法利用领域特定的语义级策略(例如，车道保持和车道改变)来近似操作空间
每个策略实现多个未来场景来处理交互不确定性

1. 语义级策略 --> 演变为最佳策略 --> 基于最佳策略做轨迹生成   (决策 --> 规划)
2. mp层多种应规划 --> 决策规划耦合 

## MARC介绍：

前向模拟生成以语义级自我策略为条件的关键场景集。未来场景进行发散性评估，构建具有动态分支点的场景树

不同风险承受能力和未来情景的 RCP 生成轨迹树



场景 --> 轨迹树    ？？ 场景定义？ 区分


## 相关工作：

现有的方法在低计算成本的复杂环境中产生有效的交互方面存在局限性


## 系统概述 

1. 预测轨迹 
2. 前向仿真 --> 自车策略为条件的关键场景集
3. 场景级发散评估 --> 动态分支点的关联场景树 
4. RCP生成最佳动机。RCP 解决了一个双层优化问题，包括用于风险度量的 LP 和用于应急规划的 iLQR


## 策略条件场景树

**构建适应交互变化的动态场景树**

通过闭环前向模拟生成策略条件的关键场景集，并通过场景级差异评估构建树表示。

仅考虑可能导致潜在风险的以策略为条件的关键场景

这种修剪过程是通过*关键车辆的选择*和对*每个意图组合的非合作行为的安全评估*来实现的。

为自我轨迹规划提供安全保证，并将其扩展到捕获*周围智能体在仿真视界中的潜在趋势*。




## BIC 有限选择中选择最佳模型


x = 观测数据 
n =  样本大小 
k = 估计的自由参数的数量 
p(x|k) 给定参数个数时观测数据的概率， 似然函数
L = 估计模型似然函数最大值

BIC = -2 log L + k log n

BIC = n ln(\simga^2_e) + k ln(n)    


误差方差是真是方差的有偏估计，因此BIC的目标是选择最小的BIC值，即最小化误差方差的估计值

P_t(j,q) = p(C_t = j, q, \eta_j, Z_{1:t}) 
